# LibIS
## Постановка задачи
Необходимо реализовать классическое приложение с использованием клиент-серверной архитектуры. Клиент должен иметь интуитивно понятный графический интерфейс для просмотра данных предметной области. Также необходимо разработать механизм для передачи запроса от клиента к серверу и получения ответа. На стороне сервера должно происходить получение и обработка запросов от клиента и последующее взаимодействие с базой данных, расположенной на машине с сервером. Для выполнения данной задачи, я решил воспользоваться возможностями языка программирования java для написания и клиентской и серверной части. Для создания графического интерфейса использована библиотека Java.Swing. Используемая БД - MY SQL SERVER.

## Описание предметной области
Предметной областью для моего проекта может служить любая общественная библиотека. В качестве пользователей могут выступать сотрудники библиотеки, которые смогут вести учет в целом за работой учреждения. В качестве объектов учета могут служить следующие сущности:
1. Клиенты - Обычные посетители библиотеки, приходящие за понравившейся книгой.
2. Читательский билет - Документ, необходимый для пользования услугами библиотеки.
3. Книга - Основной предмет, за которым посетители и приходят в библиотеку.
4. Автор - Маэстро, написавший ту или иную книгу.
5. Издательство - Организация, выпустившая книгу.

## Описание программы
При разработке данного приложения передо мной стояла задача выбрать СУБД, с которой будет взаимодействовать мой сервер. Выбор пал на MYSQL SERVER, так как на первый взгляд мне показалось, что раз java от Oracle, то и СУБД должна быть от них. На самом деле это не совсем так и возможно стоило было выбрать для небольшого проекта менее крупную СУБД. Однако были и свои плюсы в выборе данной СУБД, например механизм автоматического логирования, который позволил бы администраторам БД отслеживать всевозможные изменения данных, что помогло бы в решении различных инцидентов. При разработке структуры БД, я ровнялся на 3НФ, так как она заключает в себе и правильность хранения данных, так и удобство доступа и чтения данных для обычных разработчиков/администраторов.  
В итоге общую структуру БД можно описать с помощью данной модели:
![БД](https://github.com/cevazrem/LibIS/assets/71120846/c2c4097b-01ec-4277-abdb-135775f6f9b5)
Описание полей:
- Таблица Publishers:
  -	id - Уникальный идентификатор. Первичный ключ.
  -	name - Название организации.
  -	address - Адрес организации.
- Таблица Authors:
  -	id - Уникальный идентификатор. Первичный ключ.
  -	fio - ФИО автора.
  -	date_birth - Дата рождения автора.
  -	country_birth - Страна рождения автора.
- Таблица Books:
  - id - Уникальный идентификатор. Первичный ключ.
  - name - Название книги.
  - author - Автор. Внешний ключ на таблицу Authors.
  -	publisher - Издатель. Внешний ключ на таблицу Publishers.
  -	pub_year - Год издания.
- Таблица Clients:
  - id - Уникальный идентификатор. Первичный ключ.
  -	fio - ФИО клиента.
  -	date_birth - Дата рождения клиента.
  -	date_reg - Дата регистрации клиента в системе.
  - date_end - Дата прекращения действия клиента.
  - phone - Телефон клиента.
- Таблица Tickets:
  -	id - Уникальный идентификатор. Первичный ключ.
  -	client - Клиент, владелец билета. Внешний ключ на таблицу Clients.
  -	date_start - Дата начала действия билета.
  -	date_end - Дата окончания действия билета.
- Таблица Reserves:
  -	id - Уникальный идентификатор. Первичный ключ.
  	ticket - Билет. Внешний ключ на таблицу Tickets.
  -	book - Книга. Внешний ключ на таблицу Books.
Для взаимодействия с БД также используется соответствующий драйвер JDBC. Он позваляет нашему приложению на java отправлять запросы к SQL серверу и получать ответ по выполнению операции.

## Алгоритмические решения
-	Структура базы данных, соответствующая 3НФ. Позволяет хранить базу без излишних данных и не влиять на удобство доступа к данным.
-	Для взаимодействия клиента-сервера был реализованы два алгоритма работы с сообщениями в формате JSON. Операция создания JSON сообщения по результату запроса к базе. Операция парсинга JSON сообщения на стороне клиента с последующим заполнением визуальных форм.
-	Для наполнения БД стартовыми данными я написал SQL конвертацию, которая создает таблицы и предзаполняет их базовым набором данных.

## Описание интерфейса программы
Интерфейс, как упоминалось ранее, был реализован с использованием библиотеки Swing.
При запуске приложения пользователь видит стартовое меню, состоящее из следующих элементов:
-	Таблица с актуальными данными по взятым клиентом книгам.
-	Кнопки с названием таблиц в левой части приложения.
-	Кнопка обновления данных центральной таблицы, расположенная с правой части приложения.
![БД](https://github.com/cevazrem/LibIS/assets/71120846/dfba0b28-a755-4192-be1e-60b27e81ab85)
При нажатии любой из кнопок с названиями таблиц из левой части приложения будет открываться дополнительное меню с точным набором данных из соответствующей таблицы.
![БД](https://github.com/cevazrem/LibIS/assets/71120846/2adf080f-3add-4924-a544-6328baa90638)
На каждом из таких окон будет предоставлен набор операций для взаимодействия с БД следующих видов (набор операция зависит от таблицы):
- Refresh - Операция обновления содержимого таблицы. В этом случае из базы подгружается актуальная версия таблицы и визуализируется.
- Insert - Операция добавления новых данных. Вызывает дополнительную экранную форму для введения необходимой информации. Иногда используется возможность выбора значений из другой таблицы, как, например, при добавлении книги.
- Close - Операция закрытия определенной записи. Используется для проставления признака даты окончания действия для таблиц, где есть подобное поле. На вход подается Id удаляемой записи. При проектировании БД я старался построить все так, чтобы никакие данные не удалялись, а просто закрывались с простановкой даты окончания действия. Но иногда это не удавалось, поэтому есть еще и...
- Delete - Операция удаления определенной записи. На вход подается id удаляемой записи.

## Назначение и состав классов программы:
### Общие классы
Класс socket - необходим для настройки взаимодействия между клиентом и сервером. 
-	Конструктор класса socket() - создает localhost соединение с портом 4004 и настраивает потоки ввода/вывода.
-	Метод close_socket() - предназначен для штатного закрытия потоков и сокета.
-	Метод send_message(String message) - отправляет сообщение message на сервер/клиенту.
-	Метод String recieve_message() - получает сообщение от сервера/клиента.
### Клиент
Класс TFDemo - предназначен для создания и вывода на экран стартовой формы приложения.
-	Метод String[][] ParsJSON(String data, int mode) - парсер JSON сообщения
-	Класс DrawClients - предназначен для создания и вывода на экран формы окна с таблицей Clients.
-	Класс DrawTickets - предназначен для создания и вывода на экран формы окна с таблицей Tickets.
-	Класс DrawReserves - предназначен для создания и вывода на экран формы окна с таблицей Reserves.
-	Класс DrawBooks - предназначен для создания и вывода на экран формы окна с таблицей Books.
-	Класс DrawPublishers - предназначен для создания и вывода на экран формы окна с таблицей Publishers.
-	Класс DrawAuthors - предназначен для создания и вывода на экран формы окна с таблицей Authors.
-	Метод void ActionPerformed(ActionEvent ae) - предназначен для получения сигналов нажатия кнопок их обработки и запуска необходимых действий

Метод void main(String[] args) запускающий конструктор класса TFDemo => запускающий саму программу.

### Сервер
Класс DB_handler необходим для работы с БД
-	Конструктор класа DB_handler() - необходим для установления соединения между сервером и SQL сервером.
-	Метод close_connection() - закрывает соединение с сервером.
-	Метод clear_statement() - очищает запрос в БД.
-	Метод clear_res() - очищает результат запроса в БД 
-	Метод  String[][] select_execute(String table) - выполняет запрос типа выборки (SELECT) к соответствующей таблице table.
-	Метод String close_execute(String table, int id) - проставляет дату закрытия (UPDATE) по записи из таблицы table c номером  id.
-	Метод String delete_execute(String table, int id) - удаляет (DELETE) запись из таблицы table с номером id.
-	Метод String insert_execute(String table, String data) - Добавляет (INSERT) в таблицу table набор данных data.
-	Метод String[][] get_authors() - Возвращает список авторов, используется для подтягивания значений для выбора при вызове формы вставки данных в таблицу.
-	Метод String[][] get_publishers() - Возвращает список издателей, используется для подтягивания значений для выбора при вызове формы вставки данных в таблицу.
-	Метод String[][] get_clients() - Возвращает список клиентов, используется для подтягивания значений для выбора при вызове формы вставки данных в таблицу.
-	Метод String[][] get_books() - Возвращает список книг, используется для подтягивания значений для выбора при вызове формы вставки данных в таблицу.
-	Метод String[][] get_tickets() - Возвращает список билетов, используется для подтягивания значений для выбора при вызове формы вставки данных в таблицу.
-	Метод String create_JSON(String[][] data) - Создает JSON сообщение по набору данных data.

Метод void main(String[] args) - Создает все необходимые подключения, получает сообщений от клиента, обрабатывает их и вызывает соответствующие методы, затем отправляет ответ.
